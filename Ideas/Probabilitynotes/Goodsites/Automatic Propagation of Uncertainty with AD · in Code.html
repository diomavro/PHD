<!DOCTYPE html>
<!-- saved from url=(0075)https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html -->
<html class="gr__blog_jle_im"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/shares.json"></script><script type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/widgets.js.téléchargement"></script><script src="./Automatic Propagation of Uncertainty with AD · in Code_files/all.js.téléchargement" async="" crossorigin="anonymous"></script><script type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/1.txt"></script><script type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/1(1).txt"></script><title>Automatic Propagation of Uncertainty with AD · in Code</title><meta name="description" content="Weblog of Justin Le, covering various adventures in programming and explorations in the worlds of computation physics, and knowledge.
"><meta name="viewport" content="width=device-width,initial-scale=1.0"><meta name="flattr:id" content="3p9jqr"><meta property="og:site_name" content="in Code"><meta property="og:description" content="This post and series is a walk-through of the implementation of my uncertain library, now on hackage! Some of my favorite Haskell “tricks” involve working with exotic numeric types with custom “overloaded” numeric functions and literals that let us work with data in surprisingly elegant and expressive ways. Here is one example — from my work in experimental physics and statistics, we often deal with experimental/sampled values with inherent uncertainty. If you ever measure something to be 12.3\,\mathrm{cm}, that doesn’t mean it’s 12.300000\,\mathrm{cm} — it means that it’s somewhere between 12.2\,\mathrm{cm} and 12.4\,\mathrm{cm}…and we don’t know exactly. We can write it as 12.3 \pm 0.1\,\mathrm{cm}. The interesting thing happens when we try to add, multiply, divide numbers with uncertainty. What happens when you “add” 12 \pm 3 and 19 \pm 6? The initial guess might be 31 \pm 9, because one is \pm 3 and the other is \pm 6. But! If you actually do experiments like this several times, you’ll see that this isn’t the case. If you tried this out experimentally and simulate several hundred trials, you’ll see that the answer is actually something like 31 \pm 7. (We’ll explain why later, but feel free to stop reading this article now and try this out yourself!) Let’s write ourselves a Haskell data type that lets us work with “numbers with inherent uncertainty”: ghci&gt; let x = 14.6 +/- 0.8 ghci&gt; let y = 31 +/- 2 ghci&gt; x + y 46 +/- 2 ghci&gt; x * y 450 +/- 40 ghci&gt; sqrt (x + y) 6.8 +/- 0.2 ghci&gt; logBase y x 0.78 +/- 0.02 ghci&gt; log (x**y) 85.9 +/- 0.3"><meta property="og:type" content="article"><meta property="og:title" content="Automatic Propagation of Uncertainty with AD"><meta property="og:image" content="https://blog.jle.im/img/site_logo.jpg"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html"><meta name="twitter:card" content="summary"><meta name="twitter:creator:id" content="mstk"><link rel="author" href="https://plus.google.com/107705320197444500140"><link rel="alternate" type="application/rss+xml" title="in Code (RSS Feed)" href="http://feeds.feedburner.com/incodeblog"><link rel="canonical" href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html"><link href="https://blog.jle.im/favicon.ico" rel="shortcut icon"><link href="./Automatic Propagation of Uncertainty with AD · in Code_files/toast.css" rel="stylesheet" type="text/css"><link href="./Automatic Propagation of Uncertainty with AD · in Code_files/font.css" rel="stylesheet" type="text/css"><link href="./Automatic Propagation of Uncertainty with AD · in Code_files/main.css" rel="stylesheet" type="text/css"><link href="./Automatic Propagation of Uncertainty with AD · in Code_files/entry.css" rel="stylesheet" type="text/css"><link href="./Automatic Propagation of Uncertainty with AD · in Code_files/pygments.css" rel="stylesheet" type="text/css"><script id="facebook-jssdk" src="./Automatic Propagation of Uncertainty with AD · in Code_files/all.js(1).téléchargement"></script><script type="text/javascript" async="" src="./Automatic Propagation of Uncertainty with AD · in Code_files/widgets.js(1).téléchargement"></script><script async="" src="./Automatic Propagation of Uncertainty with AD · in Code_files/analytics.js.téléchargement"></script><script type="text/javascript">var page_data = {};
var disqus_shortname='incode';
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-443711-8', 'jle.im');
ga('send', 'pageview');
</script><script type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/jquery.min.js.téléchargement"></script><script type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/addthis_widget.js.téléchargement"></script><div id="_atssh" style="visibility: hidden; height: 1px; width: 1px; position: absolute; top: -9999px; z-index: 100000;"><iframe id="_atssh997" title="AddThis utility frame" style="height: 1px; width: 1px; position: absolute; top: 0px; z-index: 100000; border: 0px; left: 0px;" src="./Automatic Propagation of Uncertainty with AD · in Code_files/sh.f48a1a04fe8dbf021b4cda1d.html"></iframe></div><style type="text/css">.at-icon{fill:#fff;border:0}.at-icon-wrapper{display:inline-block;overflow:hidden}a .at-icon-wrapper{cursor:pointer}.at-rounded,.at-rounded-element .at-icon-wrapper{border-radius:12%}.at-circular,.at-circular-element .at-icon-wrapper{border-radius:50%}.addthis_32x32_style .at-icon{width:2pc;height:2pc}.addthis_24x24_style .at-icon{width:24px;height:24px}.addthis_20x20_style .at-icon{width:20px;height:20px}.addthis_16x16_style .at-icon{width:1pc;height:1pc}#at16lb{display:none;position:absolute;top:0;left:0;width:100%;height:100%;z-index:1001;background-color:#000;opacity:.001}#at_complete,#at_error,#at_share,#at_success{position:static!important}.at15dn{display:none}#at15s,#at16p,#at16p form input,#at16p label,#at16p textarea,#at_share .at_item{font-family:arial,helvetica,tahoma,verdana,sans-serif!important;font-size:9pt!important;outline-style:none;outline-width:0;line-height:1em}* html #at15s.mmborder{position:absolute!important}#at15s.mmborder{position:fixed!important;width:250px!important}#at15s{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpiZGBgaGAgAjAxEAlGFVJHIUCAAQDcngCUgqGMqwAAAABJRU5ErkJggg==);float:none;line-height:1em;margin:0;overflow:visible;padding:5px;text-align:left;position:absolute}#at15s a,#at15s span{outline:0;direction:ltr;text-transform:none}#at15s .at-label{margin-left:5px}#at15s .at-icon-wrapper{width:1pc;height:1pc;vertical-align:middle}#at15s .at-icon{width:1pc;height:1pc}.at4-icon{display:inline-block;background-repeat:no-repeat;background-position:top left;margin:0;overflow:hidden;cursor:pointer}.addthis_16x16_style .at4-icon,.addthis_default_style .at4-icon,.at4-icon,.at-16x16{width:1pc;height:1pc;line-height:1pc;background-size:1pc!important}.addthis_32x32_style .at4-icon,.at-32x32{width:2pc;height:2pc;line-height:2pc;background-size:2pc!important}.addthis_24x24_style .at4-icon,.at-24x24{width:24px;height:24px;line-height:24px;background-size:24px!important}.addthis_20x20_style .at4-icon,.at-20x20{width:20px;height:20px;line-height:20px;background-size:20px!important}.at4-icon.circular,.circular .at4-icon,.circular.aticon{border-radius:50%}.at4-icon.rounded,.rounded .at4-icon{border-radius:4px}.at4-icon-left{float:left}#at15s .at4-icon{text-indent:20px;padding:0;overflow:visible;white-space:nowrap;background-size:1pc;width:1pc;height:1pc;background-position:top left;display:inline-block;line-height:1pc}.addthis_vertical_style .at4-icon,.at4-follow-container .at4-icon{margin-right:5px}html>body #at15s{width:250px!important}#at15s.atm{background:none!important;padding:0!important;width:10pc!important}#at15s_inner{background:#fff;border:1px solid #fff;margin:0}#at15s_head{position:relative;background:#f2f2f2;padding:4px;cursor:default;border-bottom:1px solid #e5e5e5}.at15s_head_success{background:#cafd99!important;border-bottom:1px solid #a9d582!important}.at15s_head_success a,.at15s_head_success span{color:#000!important;text-decoration:none}#at15s_brand,#at15sptx,#at16_brand{position:absolute}#at15s_brand{top:4px;right:4px}.at15s_brandx{right:20px!important}a#at15sptx{top:4px;right:4px;text-decoration:none;color:#4c4c4c;font-weight:700}#at15sptx:hover{text-decoration:underline}#at16_brand{top:5px;right:30px;cursor:default}#at_hover{padding:4px}#at_hover .at_item,#at_share .at_item{background:#fff!important;float:left!important;color:#4c4c4c!important}#at_share .at_item .at-icon-wrapper{margin-right:5px}#at_hover .at_bold{font-weight:700;color:#000!important}#at_hover .at_item{width:7pc!important;padding:2px 3px!important;margin:1px;text-decoration:none!important}#at_hover .at_item.athov,#at_hover .at_item:focus,#at_hover .at_item:hover{margin:0!important}#at_hover .at_item.athov,#at_hover .at_item:focus,#at_hover .at_item:hover,#at_share .at_item.athov,#at_share .at_item:hover{background:#f2f2f2!important;border:1px solid #e5e5e5;color:#000!important;text-decoration:none}.ipad #at_hover .at_item:focus{background:#fff!important;border:1px solid #fff}.at15t{display:block!important;height:1pc!important;line-height:1pc!important;padding-left:20px!important;background-position:0 0;text-align:left}.addthis_button,.at15t{cursor:pointer}.addthis_toolbox a.at300b,.addthis_toolbox a.at300m{width:auto}.addthis_toolbox a{margin-bottom:5px;line-height:initial}.addthis_toolbox.addthis_vertical_style{width:200px}.addthis_button_facebook_like .fb_iframe_widget{line-height:100%}.addthis_button_facebook_like iframe.fb_iframe_widget_lift{max-width:none}.addthis_toolbox a.addthis_button_counter,.addthis_toolbox a.addthis_button_facebook_like,.addthis_toolbox a.addthis_button_facebook_send,.addthis_toolbox a.addthis_button_facebook_share,.addthis_toolbox a.addthis_button_foursquare,.addthis_toolbox a.addthis_button_linkedin_counter,.addthis_toolbox a.addthis_button_pinterest_pinit,.addthis_toolbox a.addthis_button_tweet{display:inline-block}.addthis_toolbox span.addthis_follow_label{display:none}.addthis_toolbox.addthis_vertical_style span.addthis_follow_label{display:block;white-space:nowrap}.addthis_toolbox.addthis_vertical_style a{display:block}.addthis_toolbox.addthis_vertical_style.addthis_32x32_style a{line-height:2pc;height:2pc}.addthis_toolbox.addthis_vertical_style .at300bs{margin-right:4px;float:left}.addthis_toolbox.addthis_20x20_style span{line-height:20px}.addthis_toolbox.addthis_32x32_style span{line-height:2pc}.addthis_toolbox.addthis_pill_combo_style .addthis_button_compact .at15t_compact,.addthis_toolbox.addthis_pill_combo_style a{float:left}.addthis_toolbox.addthis_pill_combo_style a.addthis_button_tweet{margin-top:-2px}.addthis_toolbox.addthis_pill_combo_style .addthis_button_compact .at15t_compact{margin-right:4px}.addthis_default_style .addthis_separator{margin:0 5px;display:inline}div.atclear{clear:both}.addthis_default_style .addthis_separator,.addthis_default_style .at4-icon,.addthis_default_style .at300b,.addthis_default_style .at300bo,.addthis_default_style .at300bs,.addthis_default_style .at300m{float:left}.at300b img,.at300bo img{border:0}a.at300b .at4-icon,a.at300m .at4-icon{display:block}.addthis_default_style .at300b,.addthis_default_style .at300bo,.addthis_default_style .at300m{padding:0 2px}.at300b,.at300bo,.at300bs,.at300m{cursor:pointer}.addthis_button_facebook_like.at300b:hover,.addthis_button_facebook_like.at300bs:hover,.addthis_button_facebook_send.at300b:hover,.addthis_button_facebook_send.at300bs:hover{opacity:1}.addthis_20x20_style .at15t,.addthis_20x20_style .at300bs{overflow:hidden;display:block;height:20px!important;width:20px!important;line-height:20px!important}.addthis_32x32_style .at15t,.addthis_32x32_style .at300bs{overflow:hidden;display:block;height:2pc!important;width:2pc!important;line-height:2pc!important}.at300bs{overflow:hidden;display:block;background-position:0 0;height:1pc;width:1pc;line-height:1pc!important}.addthis_default_style .at15t_compact,.addthis_default_style .at15t_expanded{margin-right:4px}#at_share .at_item{width:123px!important;padding:4px;margin-right:2px;border:1px solid #fff}#at16p{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpiZGBgaGAgAjAxEAlGFVJHIUCAAQDcngCUgqGMqwAAAABJRU5ErkJggg==);z-index:10000001;position:absolute;top:50%;left:50%;width:300px;padding:10px;margin:0 auto;margin-top:-185px;margin-left:-155px;font-family:arial,helvetica,tahoma,verdana,sans-serif;font-size:9pt;color:#5e5e5e}#at_share{margin:0;padding:0}#at16pt{position:relative;background:#f2f2f2;height:13px;padding:5px 10px}#at16pt a,#at16pt h4{font-weight:700}#at16pt h4{display:inline;margin:0;padding:0;font-size:9pt;color:#4c4c4c;cursor:default}#at16pt a{position:absolute;top:5px;right:10px;color:#4c4c4c;text-decoration:none;padding:2px}#at15sptx:focus,#at16pt a:focus{outline:thin dotted}#at15s #at16pf a{top:1px}#_atssh{width:1px!important;height:1px!important;border:0!important}.atm{width:10pc!important;padding:0;margin:0;line-height:9pt;letter-spacing:normal;font-family:arial,helvetica,tahoma,verdana,sans-serif;font-size:9pt;color:#444;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpiZGBgaGAgAjAxEAlGFVJHIUCAAQDcngCUgqGMqwAAAABJRU5ErkJggg==);padding:4px}.atm-f{text-align:right;border-top:1px solid #ddd;padding:5px 8px}.atm-i{background:#fff;border:1px solid #d5d6d6;padding:0;margin:0;box-shadow:1px 1px 5px rgba(0,0,0,.15)}.atm-s{margin:0!important;padding:0!important}.atm-s a:focus{border:transparent;outline:0;transition:none}#at_hover.atm-s a,.atm-s a{display:block;text-decoration:none;padding:4px 10px;color:#235dab!important;font-weight:400;font-style:normal;transition:none}#at_hover.atm-s .at_bold{color:#235dab!important}#at_hover.atm-s a:hover,.atm-s a:hover{background:#2095f0;text-decoration:none;color:#fff!important}#at_hover.atm-s .at_bold{font-weight:700}#at_hover.atm-s a:hover .at_bold{color:#fff!important}.atm-s a .at-label{vertical-align:middle;margin-left:5px;direction:ltr}.at_PinItButton{display:block;width:40px;height:20px;padding:0;margin:0;background-image:url(//s7.addthis.com/static/t00/pinit00.png);background-repeat:no-repeat}.at_PinItButton:hover{background-position:0 -20px}.addthis_toolbox .addthis_button_pinterest_pinit{position:relative}.at-share-tbx-element .fb_iframe_widget span{vertical-align:baseline!important}#at16pf{height:auto;text-align:right;padding:4px 8px}.at-privacy-info{position:absolute;left:7px;bottom:7px;cursor:pointer;text-decoration:none;font-family:helvetica,arial,sans-serif;font-size:10px;line-height:9pt;letter-spacing:.2px;color:#666}.at-privacy-info:hover{color:#000}.body .wsb-social-share .wsb-social-share-button-vert{padding-top:0;padding-bottom:0}.body .wsb-social-share.addthis_counter_style .addthis_button_tweet.wsb-social-share-button{padding-top:40px}.body .wsb-social-share.addthis_counter_style .addthis_button_facebook_like.wsb-social-share-button{padding-top:21px}@media print{#at4-follow,#at4-share,#at4-thankyou,#at4-whatsnext,#at4m-mobile,#at15s,.at4,.at4-recommended{display:none!important}}@media screen and (max-width:400px){.at4win{width:100%}}@media screen and (max-height:700px) and (max-width:400px){.at4-thankyou-inner .at4-recommended-container{height:122px;overflow:hidden}.at4-thankyou-inner .at4-recommended .at4-recommended-item:first-child{border-bottom:1px solid #c5c5c5}}</style><style type="text/css">.at-branding-logo{font-family:helvetica,arial,sans-serif;text-decoration:none;font-size:10px;display:inline-block;margin:2px 0;letter-spacing:.2px}.at-branding-logo .at-branding-icon{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF////+GlNUkcc1QAAAB1JREFUeNpiYIQDBjQmAwMmkwEM0JnY1WIxFyDAABGeAFEudiZsAAAAAElFTkSuQmCC")}.at-branding-logo .at-branding-icon,.at-branding-logo .at-privacy-icon{display:inline-block;height:10px;width:10px;margin-left:4px;margin-right:3px;margin-bottom:-1px;background-repeat:no-repeat}.at-branding-logo .at-privacy-icon{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAKCAMAAABR24SMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABhQTFRF8fr9ot/xXcfn2/P5AKva////////AKTWodjhjAAAAAd0Uk5T////////ABpLA0YAAAA6SURBVHjaJMzBDQAwCAJAQaj7b9xifV0kUKJ9ciWxlzWEWI5gMF65KUTv0VKkjVeTerqE/x7+9BVgAEXbAWI8QDcfAAAAAElFTkSuQmCC")}.at-branding-logo span{text-decoration:none}.at-branding-logo .at-branding-addthis,.at-branding-logo .at-branding-powered-by{color:#666}.at-branding-logo .at-branding-addthis:hover{color:#333}.at-cv-with-image .at-branding-addthis,.at-cv-with-image .at-branding-addthis:hover{color:#fff}a.at-branding-logo:visited{color:initial}.at-branding-info{display:inline-block;padding:0 5px;color:#666;border:1px solid #666;border-radius:50%;font-size:10px;line-height:9pt;opacity:.7;transition:all .3s ease;text-decoration:none}.at-branding-info span{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.at-branding-info:before{content:'i';font-family:Times New Roman}.at-branding-info:hover{color:#0780df;border-color:#0780df}</style><style id="service-icons-0"></style><script type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/entry_toc.js.téléchargement"></script><script type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/disqus_count.js.téléchargement"></script><script async="" type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/count.js.téléchargement"></script><script type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/social.js.téléchargement"></script><script type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/jquery.toc.js.téléchargement"></script><script type="text/javascript" src="./Automatic Propagation of Uncertainty with AD · in Code_files/entry.js.téléchargement"></script><script src="./Automatic Propagation of Uncertainty with AD · in Code_files/embed.js.téléchargement" data-timestamp="1572359643803"></script><style type="text/css"></style><link rel="prefetch" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.953a2bd009935f47a8e815c3ee2bfc5a.css"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.9ae27258a9490b17fbb3b9cdf530aff0.js"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.0adc4cfceff8c3ab4259d467d6ea3419.js"><link rel="prefetch" as="script" href="https://disqus.com/next/config.js"><script type="text/javascript" charset="utf-8" async="" src="./Automatic Propagation of Uncertainty with AD · in Code_files/counter.1e8689847c822d3197cd.js.téléchargement"></script><style type="text/css">.addthis_counter{font-weight:700;display:inline-block;border:0;outline:0;cursor:pointer;color:#fff}.addthis_counter a{display:block;font-family:arial,helvetica,sans-serif!important;text-decoration:none!important;border:0}.addthis_counter{text-decoration:none!important;text-align:left}.addthis_counter .addthis_button_expanded{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAACaCAMAAADcrusAAAAA21BMVEX////+bUznWjrnWjrBwcGJiYnm5ubFxcWMjIyRkZH39/f19fX////nWjr+bUzys6n+uq7/7+z87evqd2H+hm3/5+P+sKPxqJz65OH/9/b+el3paU//zcT2yMDshXH99vX+kXz+nIn/w7n0vrX30cz9bEv/3tn529f/1s/ukYH3aUn+ppbvnY/bUjTmWTn/3dX+9fP3aEj/9vT52NH/5d/aUTP9a0r74tzlWDjfWz386+f/7en4b1H/7uv4b1D/3db/9/X/7uraUjT+9vT87Oj87OnpZEb52dH+dlezszuQAAAABHRSTlMAExMAzBw6IQAAAnlJREFUeF6009eKKzEMBuBJriW5T2/pPdvbqb28/xMdGbOQiyxZZ9n/QnjAH8KWJxl8uqeI3H8ZJFcUmatkFktmCUXnXHIBIRevJ/AcBuUSQI0onZ8k1/QxkNqVJIvyNPl8S1/ZMFkuuYxtqhQoS2MA1RNIGKUArjwk/4Lk0jtXp0QpjEjJHiw5SbzZQlo6eUi+fafba0985LKwqSOqJdNaMdmQ5O+NOn6WYsNlPk7nnvRF6iF3lOBz/MZqZ6kvZCBS+bUn1h/MvTCXmumYArEKijlYJr6N6t8y/fcn5zz+dfwvNlhH9ZmtB8nw6REj8vg0TO4wMnfJPpbsE4zOueQGQm5eT+A5DKopgF5htjhJLvFDIE1eoeiq0+T3A/5lw2Q65TIxmdagDU4AdIsgYJUB5NUh+RMklzbPmwwxgxVq0YLBXCBvNpBVuTgkP3/hw6UnPmLamSxHbATTRjPZouDvrT5+lm7LZTHJFp60XeYhdxTgc/zGmtxg24lAhPZrT4w/WP7CXBqmEwzEaOgWYJj4Nrp9y/Tfn5zz+Hex5Ecy3EX12e+G/9mrQxUAYBgGooEFAm3//3snZmviJnL+6cMRrXSgHqsWOGb8iISEhISEqDxRAsSld5De/nLbr4MViEEYDMI5mFQ3ff/nXejx33YHcyqtc/8QQSXaRYfJZpAaFWx2FdwfMXyqYdYjp4punpP5fcgiiyyyyCKVl9+6nxQHCP+t20WHCTdIjQo2KjgDAT/Y7UQk/li1tkPtyaQlEhBARABBUV+lvhc1rz4w+FX4bKWLrA0cp7Ue+KhqnpA/mXggAQFEBBAU9VXqe1HzzgNTv2Iyx9Dc8gWOjkKMG1wfQQAAAABJRU5ErkJggg==");background-repeat:no-repeat;display:inline-block}.addthis_counter .atc_s{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUBAMAAAB/pwA+AAAAFVBMVEUAAAD///////////////////////9Iz20EAAAABnRSTlMAwPm7kB4+mBDvAAAAP0lEQVQI12MIVksDgyRTBrM0KEhmAApChRnS4ACdKcCIl5ko6MAiKAZmJjAAARsKE6GAsGE43IBwJLLTER4CAHvvQkc3Hji8AAAAAElFTkSuQmCC");background-size:10px;background-repeat:no-repeat;background-color:#fe6d4c;background-position:5px 5px;display:inline-block;border-radius:2px;min-width:25px;text-decoration:none}.addthis_counter .atc_s:hover{background-color:#e75a3a}.addthis_counter.addthis_bubble_style{background-image:url("data:image/gif;base64,R0lGODlhUgBkAKIEAOrq6sLCwoWFhf///////wAAAAAAAAAAACH5BAEAAAQALAAAAABSAGQAAAP/SLoa/jDKSetkOGsdwPhgKI5kaYpAsK1sd75wPKZsjQVyrpuq7eO7YLDnqwGFyBixuDomn6UlkwOtkqTTm3ULwmYXTi7U+3WJreSp+VxNF9fs8ZcBjz/dRo8dPSfU90l4TXqAcn1/hTuCLYSJQ31gjY45i3mTipB0kpcnlTZhnDyZdKFKo2ClMJ5GqS+rLa2dpw2xorOgtR+vg7kou7y9AzSzYBbGx8gRxAwCzc7P0NHS09TSywoCm60AAsvZwSDcxALgId2z5OUf56fp6uyj7uXwmfLg9JD2wfh9+r38X76pGwBwisCBBYscRFhP2718Dh/OWThwXb+IEidi/New+SKIhD4ozmu3sRVIhSVLnVRYcWXIluNgopPZjmY8m/VwQlQnblxKRz29VRtKtCg0YsmSOsBgtGmzNz9zDCMgEkpQWGyI+KuyElebBVuhdI2jNc5JRF+pRtUBEu3XqlYSum0DNy6jPQHqcrVEVq2ds2spYQssY2xWsGZ/9MWW+NNiqo35cpmqV8jVFkqTMXVqlEnmz1I4i4Y3twplwjqCehVTthC71VxaA3qdSPYe2oVs/0WVG7HrBqgx+f1deouKylsEFDeOPPlyNM3tPpcTXSzw2oMT4QakOzJs475n8+Ye/vZ4vOV30+rN+Pf1PacBXQWdefPopgQSAAA7");background-repeat:no-repeat}.addthis_counter a.atc_s{font-size:11px;font-weight:100;color:#fff;padding:0 5px 0 20px;line-height:20px;overflow:hidden;cursor:pointer;transition:none}.addthis_counter .atc_s-span,.addthis_counter a.atc_s{display:block;height:20px}.addthis_counter .addthis_button_expanded.at300m .at4-icon{display:none!important}.addthis_counter a.addthis_button_expanded:hover,.addthis_counter.addthis_pill_style a.addthis_button_expanded:hover{text-decoration:none;color:#000}.addthis_counter .addthis_button_expanded{display:block;background-repeat:no-repeat;background-position:0 -40px;width:50px;height:33px;line-height:33px;padding-bottom:4px;margin-bottom:3px;text-align:center;text-decoration:none;font-size:1pc;font-weight:700;color:#333}.addthis_counter{vertical-align:top}.addthis_counter.addthis_native_counter .addthis_button_expanded{font-weight:400}* html .addthis_counter.compatmode0 .addthis_button_expanded{padding-bottom:0!important}* html .addthis_counter .addthis_button_expanded{height:37px}.addthis_counter .addthis_button_expanded:hover{background-position:0 -77px;cursor:pointer;color:#000}.addthis_counter .addthis_button_expanded .at300bs{display:none!important}.addthis_counter.addthis_pill_style{display:block;height:25px;overflow:hidden}.addthis_counter.addthis_pill_style a.atc_s{float:left}.addthis_counter.addthis_pill_style a.addthis_button_expanded{display:none;background-repeat:no-repeat;background-position:0 -114px;width:34px!important;height:20px;line-height:20px;margin:0 0 0 3px;padding:0 0 0 4px;float:left;text-align:center;text-decoration:none;font-family:arial,helvetica,sans-serif;font-weight:700;font-size:11px;color:#333;-ms-box-sizing:content-box;-o-box-sizing:content-box;box-sizing:content-box}.addthis_counter.addthis_pill_style.addthis_nonzero a.addthis_button_expanded{display:block!important;transition:none}.addthis_counter.addthis_pill_style a.addthis_button_expanded:hover{background-position:0 -134px!important}.addthis_counter.addthis_bubble_style{margin:0 0 0 -2px;text-align:center;font-weight:700;font-family:arial,helvetica,sans-serif;color:#000;background-repeat:no-repeat;background-position:0 -4pc;padding:0 0 0 4px;height:1pc;width:2pc!important;-ms-box-sizing:content-box;-o-box-sizing:content-box;box-sizing:content-box}.addthis_native_counter_parent .addthis_counter.addthis_bubble_style{background-position:0 -4pc!important}.addthis_counter.addthis_bubble_style.addthis_native_counter{margin:0 2px}.addthis_counter.addthis_bubble_style a.addthis_button_expanded{font-size:11px;height:1pc;line-height:1pc;width:34px;background:none}.addthis_counter.addthis_bubble_style:hover{background-position:-36px -4pc!important}.addthis_20x20_style .addthis_counter.addthis_bubble_style{background-repeat:no-repeat;background-position:0 -5pc!important;height:20px;width:35px!important;line-height:20px;padding:0 0 0 6px}.addthis_20x20_style .addthis_counter.addthis_bubble_style:hover{background-position:-41px -5pc!important}.addthis_20x20_style .addthis_counter.addthis_bubble_style a.addthis_button_expanded{background:none;font-size:9pt;line-height:20px;height:20px;margin:0;width:35px!important;padding:0!important}.addthis_20x20_style .addthis_counter.addthis_bubble_style.addthis_native_counter a.addthis_button_expanded{font-size:11px}.addthis_32x32_style .addthis_counter.addthis_bubble_style,.addthis_32x32_white_style .addthis_counter.addthis_bubble_style{background-repeat:no-repeat;background-position:0 0!important;height:2pc;width:56px!important;line-height:2pc;padding:0 0 0 6px}.addthis_32x32_style .addthis_counter.addthis_bubble_style a.addthis_button_expanded,.addthis_32x32_white_style .addthis_counter.addthis_bubble_style a.addthis_button_expanded{background:none;font-size:1pc;line-height:2pc;height:2pc;margin:0;width:56px!important;padding:0!important}.addthis_32x32_style .addthis_counter.addthis_bubble_style:hover,.addthis_32x32_white_style .addthis_counter.addthis_bubble_style:hover{background-position:0 -2pc!important}.addthis_counter.addthis_bubble_style .atc_s{display:none!important}* html .addthis_counter.addthis_bubble_style{width:36px!important;display:inline}* html .addthis_counter.bubblecompatmode0{width:2pc!important;display:block}* html .addthis_counter.addthis_bubble_style a.addthis_button_expanded{width:24px!important;height:14px!important;line-height:14px!important;padding:0;margin-top:1px!important;display:inline}* html .addthis_counter.bubblecompatmode0 a.addthis_button_expanded{width:36px}* html .addthis_32x32_style .addthis_counter.addthis_bubble_style{width:60px!important}* html .addthis_32x32_style .addthis_counter.addthis_bubble_style a.addthis_button_expanded{width:46px;height:26px!important;line-height:26px!important;margin-top:2px!important}* html .addthis_32x32_style .addthis_counter.bubblecompatmode0 a.addthis_button_expanded{height:2pc!important;line-height:2pc!important}</style><script charset="utf-8" src="./Automatic Propagation of Uncertainty with AD · in Code_files/button.d941c9a422e2e3faf474b82a1f39e936.js.téléchargement"></script><script src="./Automatic Propagation of Uncertainty with AD · in Code_files/count-data.js.téléchargement"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_dialog_advanced{border-radius:8px;padding:10px}.fb_dialog_content{background:#fff;color:#373737}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{left:5px;right:auto;top:5px}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{height:100%;left:0;margin:0;overflow:visible;position:absolute;top:-10000px;transform:none;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{background:none;height:auto;min-height:initial;min-width:initial;width:auto}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{clear:both;color:#fff;display:block;font-size:18px;padding-top:20px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .4);bottom:0;left:0;min-height:100%;position:absolute;right:0;top:0;width:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_mobile .fb_dialog_iframe{position:sticky;top:0}.fb_dialog_content .dialog_header{background:linear-gradient(from(#738aba), to(#2c4987));border-bottom:1px solid;border-color:#043b87;box-shadow:white 0 1px 1px -1px inset;color:#fff;font:bold 14px Helvetica, sans-serif;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:linear-gradient(from(#4267B2), to(#2a4887));background-clip:padding-box;border:1px solid #29487d;border-radius:3px;display:inline-block;line-height:18px;margin-top:3px;max-width:85px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{background:none;border:none;color:#fff;font:bold 12px Helvetica, sans-serif;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #4a4a4a;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f5f6f7;border:1px solid #4a4a4a;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-position:50% 50%;background-repeat:no-repeat;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}</style></head><body data-gr-c-s-loaded="true" style=""><div id="StayFocusd-infobar" style="display: none; top: 1903px;">
    <img src="chrome-extension://laankejkbhbdhmipfmgcngdelahlfoji/common/img/eye_19x19_red.png">
    <span id="StayFocusd-infobar-msg"></span>
    <span id="StayFocusd-infobar-links">
        <a id="StayFocusd-infobar-never-show">masquer définitivement</a>&nbsp;&nbsp;|&nbsp;&nbsp;
        <a id="StayFocusd-infobar-hide">masquer une&nbsp;fois</a>
    </span>
</div><div id="fb-root" class=" fb_reset"><script>(function(d, s, id) {
 var js, fjs = d.getElementsByTagName(s)[0];
 if (d.getElementById(id)) return;
 js = d.createElement(s); js.id = id;
 js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=641852699171929";
 fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script><div style="position: absolute; top: -10000px; width: 0px; height: 0px;"><div><iframe name="fb_xdm_frame_https" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" allow="encrypted-media" src="./Automatic Propagation of Uncertainty with AD · in Code_files/xd_arbiter(1).html" style="border: none;"></iframe></div><div></div></div></div><div id="header-container"><div id="navbar-container" class="tile"><nav id="navbar-content"><div class="nav-info"><h1 class="site-title"><a href="https://blog.jle.im/" class="nav-title">in Code</a></h1><span class="nav-author">Justin Le</span></div><ul class="nav-links"><li><a href="https://blog.jle.im/">home</a></li><li><a href="https://blog.jle.im/entries.html">archives</a></li><div class="clear"></div></ul></nav></div><div id="header-content"></div></div><div id="body-container" class="container"><div id="main-container" class="grid"><div class="entry-section unit span-grid" role="main"><article class="tile article"><header><h1 id="title">Automatic Propagation of Uncertainty with AD</h1><p class="entry-info">by <a class="author" href="https://blog.jle.im/">Justin Le</a><span class="info-separator"> ♦ </span><time datetime="2016-05-09T11:38:24Z" pubdate="" class="pubdate">Monday May 9, 2016</time></p><p><span class="source-info hide"><a class="source-link" href="https://github.com/mstksg/inCode/tree/master/copy/entries/uncertainty.md">Source</a><span class="info-separator"> ♦ </span><a class="source-link" href="https://github.com/mstksg/inCode/tree/gh-pages/entry/automatic-propagation-of-uncertainty-with-ad.md">Markdown</a><span class="info-separator"> ♦ </span><a class="source-link" href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.tex">LaTeX</a><span class="info-separator"> ♦ </span></span>Posted in <a href="https://blog.jle.im/entries/category/@haskell.html" class="tag-a-category" title="Functional, pure, non-strict, statically and strongly typed, natively
compiled...really just the king of great languages.">Haskell</a>, <a href="https://blog.jle.im/entries/category/@tutorials.html" class="tag-a-category" title="Technical tutorials/walkthroughs on specific programming processes and problems
that I&#39;ve struggled through in the past.">Tutorials</a><span class="info-separator"> ♦ </span><a class="comment-link" href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#disqus_thread">9 Comments</a></p></header><hr><aside class="contents-container" style="display: block;"><h5 id="contents-header">Contents</h5><div id="toc"><ul><li class="h2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#dealing-with-uncertainty-precisely">Dealing with Uncertainty Precisely</a></li><li class="h2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#uncertain-values-in-haskell">Uncertain Values in Haskell</a></li><li class="h3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#making-it-numeric">Making it Numeric</a></li><li class="h3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#the-problem">The Problem</a></li><li class="h2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#automatic-differentiation">Automatic Differentiation</a></li><li class="h3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#single-variable-functions">Single-variable functions</a></li><li class="h3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#multivariable-functions">Multivariable functions</a></li><li class="h2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#wrapping-it-up">Wrapping it up</a></li><li class="h3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#verification-and-accuracy">Verification and Accuracy</a></li><li class="h3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#what-next">What next?</a></li></ul></div></aside><div class="main-content copy-content"><blockquote>
<p>This post and <a href="https://blog.jle.im/entries/series/+uncertain.html">series</a> is a walk-through of the implementation of my <em><a href="https://hackage.haskell.org/package/uncertain">uncertain</a></em> library, now on hackage!</p>
</blockquote>
<p>Some of my favorite Haskell “tricks” involve working with exotic numeric types with custom “overloaded” numeric functions and literals that let us work with data in surprisingly elegant and expressive ways.</p>
<p>Here is one example — from my work in experimental physics and statistics, we often deal with experimental/sampled values with inherent uncertainty. If you ever measure something to be <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png.latex" alt="12.3\,\mathrm{cm}" title="12.3\,\mathrm{cm}">, that doesn’t mean it’s <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(1).latex" alt="12.300000\,\mathrm{cm}" title="12.300000\,\mathrm{cm}"> — it means that it’s somewhere between <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(2).latex" alt="12.2\,\mathrm{cm}" title="12.2\,\mathrm{cm}"> and <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(3).latex" alt="12.4\,\mathrm{cm}" title="12.4\,\mathrm{cm}">…and we don’t know exactly. We can write it as <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(4).latex" alt="12.3 \pm 0.1\,\mathrm{cm}" title="12.3 \pm 0.1\,\mathrm{cm}">. The interesting thing happens when we try to add, multiply, divide numbers with uncertainty. What happens when you “add” <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(5).latex" alt="12 \pm 3" title="12 \pm 3"> and <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(6).latex" alt="19 \pm 6" title="19 \pm 6">?</p>
<p>The initial guess might be <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(7).latex" alt="31 \pm 9" title="31 \pm 9">, because one is <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(8).latex" alt="\pm 3" title="\pm 3"> and the other is <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(9).latex" alt="\pm 6" title="\pm 6">. But! If you actually do experiments like this several times, you’ll see that this isn’t the case. If you tried this out experimentally and simulate several hundred trials, you’ll see that the answer is actually something like <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(10).latex" alt="31 \pm 7" title="31 \pm 7">. (We’ll explain why later, but feel free to stop reading this article now and try this out yourself!<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>)</p>
<p>Let’s write ourselves a Haskell data type that lets us work with “numbers with inherent uncertainty”:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell code-block-prompt"><code class="sourceCode haskell"><span id="cb1-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-1"></a>ghci<span class="op">&gt;</span> <span class="kw">let</span> x <span class="ot">=</span> <span class="fl">14.6</span> <span class="op">+/-</span> <span class="fl">0.8</span></span>
<span id="cb1-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-2"></a>ghci<span class="op">&gt;</span> <span class="kw">let</span> y <span class="ot">=</span> <span class="dv">31</span>   <span class="op">+/-</span> <span class="dv">2</span></span>
<span id="cb1-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-3"></a>ghci<span class="op">&gt;</span> x <span class="op">+</span> y</span>
<span id="cb1-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-4"></a><span class="dv">46</span> <span class="op">+/-</span> <span class="dv">2</span></span>
<span id="cb1-5"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-5"></a>ghci<span class="op">&gt;</span> x <span class="op">*</span> y</span>
<span id="cb1-6"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-6"></a><span class="dv">450</span> <span class="op">+/-</span> <span class="dv">40</span></span>
<span id="cb1-7"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-7"></a>ghci<span class="op">&gt;</span> <span class="fu">sqrt</span> (x <span class="op">+</span> y)</span>
<span id="cb1-8"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-8"></a><span class="fl">6.8</span> <span class="op">+/-</span> <span class="fl">0.2</span></span>
<span id="cb1-9"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-9"></a>ghci<span class="op">&gt;</span> <span class="fu">logBase</span> y x</span>
<span id="cb1-10"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-10"></a><span class="fl">0.78</span> <span class="op">+/-</span> <span class="fl">0.02</span></span>
<span id="cb1-11"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-11"></a>ghci<span class="op">&gt;</span> <span class="fu">log</span> (x<span class="op">**</span>y)</span>
<span id="cb1-12"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb1-12"></a><span class="fl">85.9</span> <span class="op">+/-</span> <span class="fl">0.3</span></span></code></pre></div>
<p>Along the way, we’ll also learn how to harness the power of awesome <a href="https://hackage.haskell.org/package/ad">ad</a> library, a library used in implementing back-propagation and other optimization algorithms, to analyze numerical functions in a mathematical way and break down their derivatives and gradients.</p>
<p>You can follow along with <a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs">the source code</a>, which is actually a <em><a href="http://www.haskellstack.org/">stack</a></em> executable! If you download the source and you have <em><a href="http://www.haskellstack.org/">stack</a></em> installed, you can run it (and run the tests above) as an executable:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-block-prompt"><code class="sourceCode bash"><span id="cb2-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb2-1"></a>$ <span class="ex">./Uncertain.hs</span></span></code></pre></div>
<p>Otherwise, you can run it directly with stack (using <code>runhaskell</code>) and the <a href="shttp://hackage.haskell.org/package/linear/docs/Linear-V2.html">linear</a> and <a href="https://hackage.haskell.org/package/ad">ad</a> packages installed…or load it up with <code>stack ghci</code> to play with it. If you want to be sure to reproduce the behavior, this article was written under <a href="https://www.stackage.org/">stackage</a> snapshot <a href="https://www.stackage.org/lts-5.15">lts-5.15</a>.</p>
<h2 id="dealing-with-uncertainty-precisely">Dealing with Uncertainty Precisely<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#title" class="top-link">top</a></h2>
<p>First of all, let’s think about why adding two “uncertain” values doesn’t involve simply adding the uncertainties linearly. (If you don’t care about the math and just want to get on to the Haskell, feel free to skip this section!)</p>
<p>If I have a value <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(11).latex" alt="16 \pm 3" title="16 \pm 3"> (maybe I have a ruler whose ticks are 3 units apart, or an instrument that produces measurements with 3 units of noise), it either means that it’s a little below 16 or a little above 16. If I have an independently sampled value <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(12).latex" alt="25 \pm 4" title="25 \pm 4">, it means that it’s a little below 25 or a little above 25.</p>
<p>What happens if I want to think about their sum? Well, it’s going to be somewhere around 41. But, the uncertainty won’t be <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(13).latex" alt="\pm 7" title="\pm 7">. It would only be <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(13).latex" alt="\pm 7" title="\pm 7"> if the errors in the two values are <em>always aligned</em>. Only if or when every “little bit above” 16 error lines up perfectly with a “little bit above” 25 error, and when every single “little bit below” 16 error lines up perfectly with a “little bit above” 25 error, would you really get something that is <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(13).latex" alt="\pm 7" title="\pm 7">. But, because the two values are sampled independently, you shouldn’t expect such alignment. So, you’ll get an uncertainty that’s <em>less than</em> <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(13).latex" alt="\pm 7" title="\pm 7">. In fact, it’ll actually be around <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(14).latex" alt="\pm 5" title="\pm 5">.</p>
<p>In general, we find that for <em>independent</em> <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(15).latex" alt="X" title="X"> and <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(16).latex" alt="Y" title="Y">:</p>
<p><br><img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(17).latex" alt="
\operatorname{Var}[aX + bY + c] = a^2 \sigma_X^2 + b^2 \sigma_Y^2
" title="
\operatorname{Var}[aX + bY + c] = a^2 \sigma_X^2 + b^2 \sigma_Y^2
"><br></p>
<p>Where <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(18).latex" alt="\sigma_X^2" title="\sigma_X^2"> is the variance in <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(15).latex" alt="X" title="X">. We consider <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(19).latex" alt="\sigma_X" title="\sigma_X"> to be the standard deviation of <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(15).latex" alt="X" title="X">, or the “plus or minus” part of our numbers. In the simple case of addition, we have <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(20).latex" alt="\operatorname{Var}[X + Y] = \sigma_X^2 + \sigma_Y^2" title="\operatorname{Var}[X + Y] = \sigma_X^2 + \sigma_Y^2">, so our new uncertainty<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> is <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(21).latex" alt="\sqrt{\sigma_X^2 + \sigma_Y^2}" title="\sqrt{\sigma_X^2 + \sigma_Y^2}">.</p>
<p>However, not all functions that combine <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(15).latex" alt="X" title="X"> and <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(16).latex" alt="Y" title="Y"> can be expressed as simple linear combinations <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(22).latex" alt="aX + bY + c" title="aX + bY + c">. But! If you dig back to your days of high school calculus, you might remember a method for expressing any arbitrary function as a linear approximation – the <a href="https://en.wikipedia.org/wiki/Taylor_series">Taylor Expansion</a>!</p>
<p>In general, we can attempt to approximate any well-behaving function around a point as its tangent hyperplane:</p>
<p><br><img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(23).latex" alt="
f(x_0 + x, y_0 + y) \approx f_x(x_0, y_0) x + f_y(x_0, y_0) y + f(x_0, y_0)
" title="
f(x_0 + x, y_0 + y) \approx f_x(x_0, y_0) x + f_y(x_0, y_0) y + f(x_0, y_0)
"><br></p>
<p>Where <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(24).latex" alt="f_x(x_0,y_0)" title="f_x(x_0,y_0)"> is the first (partial) derivative with respect to <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(25).latex" alt="x" title="x"> at <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(26).latex" alt="(x_0, y_0)" title="(x_0, y_0)">. This gives us an approximation of <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(27).latex" alt="f" title="f"> at locations close to <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(26).latex" alt="(x_0, y_0)" title="(x_0, y_0)">.</p>
<p>Look familiar? This is exactly the form that we used earlier to calculate “combined” variance! If we approximate the functions around <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(28).latex" alt="(\mu_X, \mu_Y)" title="(\mu_X, \mu_Y)">, the center/expected value of <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(15).latex" alt="X" title="X"> and <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(16).latex" alt="Y" title="Y">, we see:</p>
<p><br><img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(29).latex" alt="
\operatorname{Var}[f(X,Y)] \approx f_x(\mu_X, \mu_Y)^2 \sigma_X^2 + f_y(\mu_X,\mu_Y)^2 \sigma_Y^2
" title="
\operatorname{Var}[f(X,Y)] \approx f_x(\mu_X, \mu_Y)^2 \sigma_X^2 + f_y(\mu_X,\mu_Y)^2 \sigma_Y^2
"><br></p>
<p>A similar analysis can be used to figure out how the expected value changes by taking the taylor expansion to the <em>second</em> degree:</p>
<p><br><img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(30).latex" alt="
\operatorname{E}[f(X,Y)] \approx
f(\mu_X, \mu_Y) + \frac{1}{2}
\left[ f_{xx}(\mu_X, \mu_Y) \sigma_X^2 + f_{yy}(\mu_X, \mu_Y) \sigma_Y^2 \right]
" title="
\operatorname{E}[f(X,Y)] \approx
f(\mu_X, \mu_Y) + \frac{1}{2}
\left[ f_{xx}(\mu_X, \mu_Y) \sigma_X^2 + f_{yy}(\mu_X, \mu_Y) \sigma_Y^2 \right]
"><br></p>
<p>Where <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(31).latex" alt="f_{xx}(\mu_X, \mu_Y)" title="f_{xx}(\mu_X, \mu_Y)"> is the second (partial) derivative with respect to <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(25).latex" alt="x" title="x"> twice at <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(28).latex" alt="(\mu_X, \mu_Y)" title="(\mu_X, \mu_Y)"></p>
<p>For our case of simple addition, <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(32).latex" alt="\operatorname{E}[X + Y] = \mu_X + \mu_Y" title="\operatorname{E}[X + Y] = \mu_X + \mu_Y">, because the second-order partials of <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(33).latex" alt="f(x,y) = x + y" title="f(x,y) = x + y"> are 0.</p>
<h2 id="uncertain-values-in-haskell">Uncertain Values in Haskell<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#title" class="top-link">top</a></h2>
<p>So, how are we going to model our uncertain values in Haskell … ? With an Algebraic Data Type, of course!</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><div class="code-link-box hide"><a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs#L18-L20" class="code-source-link">View full source</a></div><code class="sourceCode haskell"><span id="cb3-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb3-3"></a><span class="kw">data</span> <span class="dt">Uncert</span> a <span class="ot">=</span> <span class="dt">Un</span> {<span class="ot"> uMean ::</span> <span class="op">!</span>a</span>
<span id="cb3-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb3-4"></a>                   ,<span class="ot"> uVar  ::</span> <span class="op">!</span>a</span>
<span id="cb3-5"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb3-5"></a>                   }</span></code></pre></div>
<p>We’ll keep track of the mean (the central point) and the <em>variance</em>, which is the standard deviation <em>squared</em>. We keep track of the variance and not the standard deviation (the “plus or minus”) because the mathematics is a bit more straightforward.</p>
<p>We can write a function to turn a “plus or minus” statement into an <code>Uncert</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><div class="code-link-box hide"><a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs#L22-L23" class="code-source-link">View full source</a></div><code class="sourceCode haskell"><span id="cb4-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb4-3"></a><span class="ot">(+/-) ::</span> <span class="dt">Num</span> a <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb4-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb4-4"></a>x <span class="op">+/-</span> dx <span class="ot">=</span> <span class="dt">Un</span> x (dx<span class="op">*</span>dx)</span></code></pre></div>
<p>Give the <code>dx</code> (the standard deviation) and store <code>dx^2</code>, the variance.</p>
<p>Let’s also throw in a handy helper function for “exact” values:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><div class="code-link-box hide"><a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs#L25-L26" class="code-source-link">View full source</a></div><code class="sourceCode haskell"><span id="cb5-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb5-3"></a><span class="ot">exact ::</span> <span class="dt">Num</span> a <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb5-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb5-4"></a>exact x <span class="ot">=</span> x <span class="op">+/-</span> <span class="dv">0</span></span></code></pre></div>
<p>But, we can do better (if just for fun). We can use pattern synonyms to basically “abstract” away the data type itself, and let people pattern match on a mean and standard deviation:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><div class="code-link-box hide"><a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs#L28-L31" class="code-source-link">View full source</a></div><code class="sourceCode haskell"><span id="cb6-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb6-3"></a><span class="kw">pattern</span><span class="ot"> (:+/-) ::</span> <span class="dt">Floating</span> a <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb6-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb6-4"></a><span class="kw">pattern</span> x <span class="op">:+/-</span> dx <span class="ot">&lt;-</span> <span class="dt">Un</span> x (<span class="fu">sqrt</span><span class="ot">-&gt;</span>dx)</span>
<span id="cb6-5"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb6-5"></a>  <span class="kw">where</span></span>
<span id="cb6-6"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb6-6"></a>    x <span class="op">:+/-</span> dx <span class="ot">=</span> <span class="dt">Un</span> x (dx<span class="op">*</span>dx)</span></code></pre></div>
<p>(Note that GHC 8.0 introduces a new type signature format for pattern synonyms, so this will only work in GHC 8.0 or above as-is)</p>
<p>Now, people can pattern match on <code>x :+/- dx</code> and receive the mean and uncertainty directly. Neat!</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><div class="code-link-box hide"><a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs#L33-L34" class="code-source-link">View full source</a></div><code class="sourceCode haskell"><span id="cb7-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb7-3"></a><span class="ot">uStdev ::</span> <span class="dt">Floating</span> a <span class="ot">=&gt;</span> <span class="dt">Uncert</span> a <span class="ot">-&gt;</span> a</span>
<span id="cb7-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb7-4"></a>uStdev (_ <span class="op">:+/-</span> dx) <span class="ot">=</span> dx</span></code></pre></div>
<h3 id="making-it-numeric">Making it Numeric<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#title" class="top-link">top</a></h3>
<p>Now, time for the magic! Let’s write a <code>Num</code> instance!</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb8-1"></a><span class="kw">instance</span> <span class="dt">Num</span> a <span class="ot">=&gt;</span> <span class="dt">Num</span> (<span class="dt">Uncert</span> a) <span class="kw">where</span></span>
<span id="cb8-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb8-2"></a>    <span class="fu">fromIntegral</span>      <span class="ot">=</span> exact <span class="op">.</span> <span class="fu">fromIntegral</span></span>
<span id="cb8-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb8-3"></a>    <span class="dt">Un</span> x vx <span class="op">+</span> <span class="dt">Un</span> y vy <span class="ot">=</span> <span class="dt">Un</span> (x <span class="op">+</span> y)    (vx <span class="op">+</span> vy)</span>
<span id="cb8-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb8-4"></a>    <span class="dt">Un</span> x vx <span class="op">-</span> <span class="dt">Un</span> y vy <span class="ot">=</span> <span class="dt">Un</span> (x <span class="op">-</span> y)    (vx <span class="op">+</span> vy)</span>
<span id="cb8-5"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb8-5"></a>    <span class="dt">Un</span> x vx <span class="op">*</span> <span class="dt">Un</span> y vy <span class="ot">=</span> <span class="dt">Un</span> (x <span class="op">*</span> y)    (y<span class="op">^</span><span class="dv">2</span> <span class="op">*</span> vx <span class="op">+</span> x<span class="op">^</span><span class="dv">2</span> <span class="op">*</span> vy)</span>
<span id="cb8-6"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb8-6"></a>    <span class="fu">negate</span> (<span class="dt">Un</span> x vx)  <span class="ot">=</span> <span class="dt">Un</span> (<span class="fu">negate</span> x) vx</span>
<span id="cb8-7"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb8-7"></a>    <span class="co">-- ...</span></span></code></pre></div>
<p>And…that’s it! Do the same thing for every numeric typeclass, and you get automatic propagation of uncertainty.</p>
<h3 id="the-problem">The Problem<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#title" class="top-link">top</a></h3>
<p>But, wait — this method is definitely not ideal. It’s pretty repetitive, and involves a but of copy-and-pasting code that is slightly different in ways the typechecker can’t verify. What if we didn’t change something we were supposed to? And, if you look at the <code>Fractional</code> instance…</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb9-1"></a><span class="kw">instance</span> <span class="dt">Fractional</span> a <span class="ot">=&gt;</span> <span class="dt">Fractional</span> (<span class="dt">Uncert</span> a) <span class="kw">where</span></span>
<span id="cb9-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb9-2"></a>    <span class="fu">fromRational</span>      <span class="ot">=</span> exact <span class="op">.</span> <span class="fu">fromRational</span></span>
<span id="cb9-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb9-3"></a>    <span class="dt">Un</span> x vx <span class="op">/</span> <span class="dt">Un</span> y vy <span class="ot">=</span> <span class="dt">Un</span> (x<span class="op">/</span>y <span class="op">+</span> x<span class="op">/</span>y<span class="op">^</span><span class="dv">3</span><span class="op">*</span>vy)   (x<span class="op">^</span><span class="dv">2</span><span class="op">/</span>y<span class="op">^</span><span class="dv">4</span><span class="op">*</span>vx <span class="op">+</span> vy<span class="op">/</span>y<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb9-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb9-4"></a>    <span class="fu">recip</span> (<span class="dt">Un</span> x vx)   <span class="ot">=</span> <span class="dt">Un</span> (<span class="fu">recip</span> x <span class="op">+</span> vx<span class="op">/</span>x<span class="op">^</span><span class="dv">3</span>) (vx <span class="op">/</span> x<span class="op">^</span><span class="dv">4</span>)</span></code></pre></div>
<p>Yikes. All that ugly and complicated numerical code that the typechecker can’t help us with (and, honestly, I’m not very confident in the results myself!). Those are runtime bugs just waiting to happen. How do we even <em>know</em> that we calculated the right derivatives, and implemented the formula correctly?</p>
<p>What if we could reduce this boilerplate? What if we could somehow analytically compute derivatives for functions instead of computing them manually?</p>
<h2 id="automatic-differentiation">Automatic Differentiation<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#title" class="top-link">top</a></h2>
<p>Automatic differentiation is honestly one of the coolest Haskell tricks you can show that any beginner can immediately understand. Like our trick with <code>Uncert</code>, it’s nice to use because of its overloaded <code>Num</code>/numeric typeclasses.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell code-block-prompt"><code class="sourceCode haskell"><span id="cb10-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb10-1"></a>ghci<span class="op">&gt;</span> diff (\x <span class="ot">-&gt;</span> x<span class="op">^</span><span class="dv">2</span>) <span class="dv">10</span>       <span class="co">-- 2*x</span></span>
<span id="cb10-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb10-2"></a><span class="dv">20</span></span>
<span id="cb10-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb10-3"></a>ghci<span class="op">&gt;</span> diff (\x <span class="ot">-&gt;</span> <span class="fu">sin</span> x) <span class="dv">0</span>      <span class="co">-- cos x</span></span>
<span id="cb10-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb10-4"></a><span class="fl">1.0</span></span>
<span id="cb10-5"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb10-5"></a>ghci<span class="op">&gt;</span> diff (\x <span class="ot">-&gt;</span> x<span class="op">^</span><span class="dv">3</span> <span class="op">-</span> <span class="dv">3</span><span class="op">*</span>x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>x <span class="op">-</span> <span class="dv">4</span>) <span class="dv">3</span>  <span class="co">-- 3*x^2 - 6*x + 2</span></span>
<span id="cb10-6"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb10-6"></a><span class="dv">11</span></span></code></pre></div>
<p>A very rough explanation about how forward-mode automatic differentiation works is that it uses a wrapper type (like ours) that defines <code>*</code>, <code>negate</code>, etc. so that they also compute the <em>derivative(s)</em> of the function, instead of just the <em>result</em>, like normal. There are a lot of nice tutorials online, like <a href="http://www.danielbrice.net/blog/10/">this one</a> by Daniel Brice, if you want to follow up on this fun little subject.</p>
<h3 id="single-variable-functions">Single-variable functions<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#title" class="top-link">top</a></h3>
<p>And, now that we can automatically differentiate functions, we can use this knowledge directly in our implementations. Let’s define a universal “lifter” of single-variable functions.</p>
<p>We use the function <code>diffs0</code> to get a “tower” of derivatives:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell code-block-prompt"><code class="sourceCode haskell"><span id="cb11-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb11-1"></a>ghci<span class="op">&gt;</span> diffs0 (\x <span class="ot">-&gt;</span> x<span class="op">^</span><span class="dv">2</span> <span class="op">-</span> <span class="dv">2</span> x<span class="op">^</span><span class="dv">3</span>) <span class="dv">4</span></span>
<span id="cb11-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb11-2"></a>[<span class="op">-</span><span class="dv">112</span>, <span class="op">-</span><span class="dv">88</span>, <span class="op">-</span><span class="dv">46</span>, <span class="op">-</span><span class="dv">12</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span><span class="op">...</span></span></code></pre></div>
<p>The first value is actually <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(34).latex" alt="4^2 - 2 \times 4^3" title="4^2 - 2 \times 4^3">. The second is the derivative (<img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(35).latex" alt="2 x - 6x^2" title="2 x - 6x^2">) at 4, the third is the second derivative <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(36).latex" alt="2 - 12 x" title="2 - 12 x"> at 4, then the third derivative <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(37).latex" alt="-12" title="-12">, then the fourth derivative <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(38).latex" alt="0" title="0">, etc.</p>
<p>We only need the actual value and the first two derivatives, so we can pattern match them as <code>fx:dfx:ddfx:_ = diffs0 f x</code>, the derivatives and values of the function we lift, <code>f</code>, around the mean <code>x</code>.</p>
<p>At that point, the equations we have from before just translate nicely:</p>
<p><br><img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(39).latex" alt="
\operatorname{E}[f(X)] = f(\mu_X) + \frac{1}{2} f_{xx}(\mu_X) \sigma_X^2
" title="
\operatorname{E}[f(X)] = f(\mu_X) + \frac{1}{2} f_{xx}(\mu_X) \sigma_X^2
"><br></p>
<p><br><img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(40).latex" alt="
\operatorname{Var}[f(X)] = f_x(\mu_X)^2 \sigma_X^2
" title="
\operatorname{Var}[f(X)] = f_x(\mu_X)^2 \sigma_X^2
"><br></p>
<p>And we call <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(41).latex" alt="\mu_X" title="\mu_X"> <code>x</code> and <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(18).latex" alt="\sigma_X^2" title="\sigma_X^2"> <code>vx</code>, and this becomes:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb12-1"></a>y  <span class="ot">=</span> fx <span class="op">+</span> ddfx <span class="op">*</span> vx <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb12-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb12-2"></a>vy <span class="ot">=</span> dfx<span class="op">^</span><span class="dv">2</span> <span class="op">*</span> vx</span></code></pre></div>
<p>Putting it all together:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><div class="code-link-box hide"><a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs#L36-L44" class="code-source-link">View full source</a></div><code class="sourceCode haskell"><span id="cb13-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb13-3"></a><span class="ot">liftU ::</span> <span class="dt">Fractional</span> a</span>
<span id="cb13-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb13-4"></a>      <span class="ot">=&gt;</span> (<span class="kw">forall</span> s<span class="op">.</span> <span class="dt">AD</span> s (<span class="dt">Tower</span> a) <span class="ot">-&gt;</span> <span class="dt">AD</span> s (<span class="dt">Tower</span> a))</span>
<span id="cb13-5"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb13-5"></a>      <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb13-6"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb13-6"></a>      <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb13-7"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb13-7"></a>liftU f (<span class="dt">Un</span> x vx) <span class="ot">=</span> <span class="dt">Un</span> y vy</span>
<span id="cb13-8"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb13-8"></a>  <span class="kw">where</span></span>
<span id="cb13-9"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb13-9"></a>    fx<span class="op">:</span>dfx<span class="op">:</span>ddfx<span class="op">:</span>_ <span class="ot">=</span> diffs0 f x</span>
<span id="cb13-10"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb13-10"></a>    y             <span class="ot">=</span> fx <span class="op">+</span> ddfx <span class="op">*</span> vx <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb13-11"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb13-11"></a>    vy            <span class="ot">=</span> dfx<span class="op">^</span><span class="dv">2</span> <span class="op">*</span> vx</span></code></pre></div>
<p>The type <code>forall s. AD s (Tower a) -&gt; AD s (Tower a)</code> looks a little scary, but you can think of it as representing a function on <code>a</code> (like <code>negate</code>, <code>(*2)</code>, etc.) that the <em>ad</em> library can differentiate several times — something you could use with <code>diff0</code> to get a “tower” of derivatives.</p>
<p>And … that’s it! We can already define things like:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb14-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb14-1"></a><span class="fu">negate</span> <span class="ot">=</span> liftU <span class="fu">negate</span></span>
<span id="cb14-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb14-2"></a><span class="fu">recip</span>  <span class="ot">=</span> liftU <span class="fu">recip</span></span>
<span id="cb14-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb14-3"></a><span class="fu">sqrt</span>   <span class="ot">=</span> liftU <span class="fu">sqrt</span></span>
<span id="cb14-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb14-4"></a><span class="fu">sin</span>    <span class="ot">=</span> liftU <span class="fu">sin</span></span></code></pre></div>
<h3 id="multivariable-functions">Multivariable functions<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#title" class="top-link">top</a></h3>
<p><em>ad</em> also lets you work multivariable functions, too. To model multivariable functions, it takes a function from a <code>Traversable</code> of vales to a single value. We can use the <code>V2</code> type from the <em><a href="shttp://hackage.haskell.org/package/linear/docs/Linear-V2.html">linear</a></em> package to pass in a two-variable function:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell code-block-prompt"><code class="sourceCode haskell"><span id="cb15-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb15-1"></a>ghci<span class="op">&gt;</span> grad (\(<span class="dt">V2</span> x y) <span class="ot">-&gt;</span> x <span class="op">*</span> y<span class="op">^</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>x) (<span class="dt">V2</span> <span class="dv">3</span> <span class="dv">1</span>)</span>
<span id="cb15-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb15-2"></a><span class="dt">V2</span> <span class="dv">4</span> <span class="dv">6</span></span></code></pre></div>
<p>The gradient of <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(42).latex" alt="f(x, y) = x y^2 + 3x" title="f(x, y) = x y^2 + 3x"> is <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(43).latex" alt="(y^2 + 3, 2xy)" title="(y^2 + 3, 2xy)">, which, at <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(44).latex" alt="(3, 1)" title="(3, 1)">, is indeed <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(45).latex" alt="(4, 6)" title="(4, 6)">.</p>
<p>The gradient gives us the first order partials, but we need the second order partials to calculate the new mean, so for that, we can use <code>hessian</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell code-block-prompt"><code class="sourceCode haskell"><span id="cb16-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb16-1"></a>ghci<span class="op">&gt;</span> hessian (\(<span class="dt">V2</span> x y) <span class="ot">-&gt;</span> x <span class="op">*</span> y<span class="op">^</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>x) (<span class="dt">V2</span> <span class="dv">3</span> <span class="dv">1</span>)</span>
<span id="cb16-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb16-2"></a><span class="dt">V2</span> (<span class="dt">V2</span> <span class="dv">0</span> <span class="dv">2</span>)</span>
<span id="cb16-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb16-3"></a>   (<span class="dt">V2</span> <span class="dv">2</span> <span class="dv">6</span>)</span></code></pre></div>
<p>The <a href="https://en.wikipedia.org/wiki/Hessian_matrix">hessian</a> of a function <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(46).latex" alt="f(x,y)" title="f(x,y)"> is basically a matrix of second-order partial derivatives:</p>
<p><br><img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(47).latex" alt="
\begin{bmatrix}
f_{xx}(x, y) &amp; f_{yx}(x, y) \\
f_{yx}(x, y) &amp; f_{yy}(x, y)
\end{bmatrix}
" title="
\begin{bmatrix}
f_{xx}(x, y) &amp; f_{yx}(x, y) \\
f_{yx}(x, y) &amp; f_{yy}(x, y)
\end{bmatrix}
"><br></p>
<p>In our case, we only care about the diagonal – the repeated double-derivatives, <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(48).latex" alt="f_{xx}" title="f_{xx}"> and <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(49).latex" alt="f_{yy}" title="f_{yy}">. Indeed, the double-partial of our function respect to <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(25).latex" alt="x" title="x"> is <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(38).latex" alt="0" title="0">, and the double-partial with respect to <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(50).latex" alt="y" title="y"> is <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(51).latex" alt="2x" title="2x">, which gives us a hessian with a diagonal <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(52).latex" alt="(0, 6)" title="(0, 6)"> for the input <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(44).latex" alt="(3, 1)" title="(3, 1)">.</p>
<p>The <em>ad</em> package generously gives us a function that lets us calculate the function’s result, its gradient, and its hessian all in one pass:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell code-block-prompt"><code class="sourceCode haskell"><span id="cb17-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb17-1"></a>ghci<span class="op">&gt;</span> hessian' (\(<span class="dt">V2</span> x y) <span class="ot">-&gt;</span> x <span class="op">*</span> y<span class="op">^</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>x) (<span class="dt">V2</span> <span class="dv">3</span> <span class="dv">1</span>)</span>
<span id="cb17-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb17-2"></a>(<span class="dv">12</span>, <span class="dt">V2</span> (<span class="dv">4</span>, <span class="dt">V2</span> <span class="dv">0</span> <span class="dv">3</span>)</span>
<span id="cb17-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb17-3"></a>     <span class="dt">V2</span> (<span class="dv">6</span>, <span class="dt">V2</span> <span class="dv">2</span> <span class="dv">6</span>)</span>
<span id="cb17-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb17-4"></a>)</span></code></pre></div>
<p>We can access the gradient by using <code>fmap fst</code> on the second component of the tuple and access the hessian by using <code>fmap snd</code>.</p>
<p>We need a couple of helpers, first — one to get the “diagonal” of our hessian, because we only care about the repeated partials:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><div class="code-link-box hide"><a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs#L46-L50" class="code-source-link">View full source</a></div><code class="sourceCode haskell"><span id="cb18-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb18-3"></a><span class="ot">diag ::</span> [[a]] <span class="ot">-&gt;</span> [a]</span>
<span id="cb18-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb18-4"></a>diag <span class="ot">=</span> \<span class="kw">case</span></span>
<span id="cb18-5"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb18-5"></a>    []        <span class="ot">-&gt;</span> []</span>
<span id="cb18-6"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb18-6"></a>    []   <span class="op">:</span>yss <span class="ot">-&gt;</span> diag (<span class="fu">drop</span> <span class="dv">1</span> <span class="op">&lt;$&gt;</span> yss)</span>
<span id="cb18-7"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb18-7"></a>    (x<span class="op">:</span>_)<span class="op">:</span>yss <span class="ot">-&gt;</span> x <span class="op">:</span> diag (<span class="fu">drop</span> <span class="dv">1</span> <span class="op">&lt;$&gt;</span> yss)</span></code></pre></div>
<p>And then a “dot product”, utility function, which just multiplies two lists together component-by-component and sums the results:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><div class="code-link-box hide"><a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs#L52-L53" class="code-source-link">View full source</a></div><code class="sourceCode haskell"><span id="cb19-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb19-3"></a><span class="ot">dot ::</span> <span class="dt">Num</span> a <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> a</span>
<span id="cb19-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb19-4"></a>dot xs ys <span class="ot">=</span> <span class="fu">sum</span> (<span class="fu">zipWith</span> (<span class="op">*</span>) xs ys)</span></code></pre></div>
<p>And now we can write our multi-variate function lifter:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><div class="code-link-box hide"><a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs#L55-L72" class="code-source-link">View full source</a></div><code class="sourceCode haskell"><span id="cb20-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-3"></a><span class="ot">liftUF ::</span> (<span class="dt">Traversable</span> f, <span class="dt">Fractional</span> a)</span>
<span id="cb20-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-4"></a>       <span class="ot">=&gt;</span> (<span class="kw">forall</span> s<span class="op">.</span> f (<span class="dt">AD</span> s (<span class="dt">Sparse</span> a)) <span class="ot">-&gt;</span> <span class="dt">AD</span> s (<span class="dt">Sparse</span> a))</span>
<span id="cb20-5"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-5"></a>       <span class="ot">-&gt;</span> f (<span class="dt">Uncert</span> a)</span>
<span id="cb20-6"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-6"></a>       <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb20-7"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-7"></a>liftUF f us <span class="ot">=</span> <span class="dt">Un</span> y vy</span>
<span id="cb20-8"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-8"></a>  <span class="kw">where</span></span>
<span id="cb20-9"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-9"></a>    xs          <span class="ot">=</span>         uMean <span class="op">&lt;$&gt;</span> us</span>
<span id="cb20-10"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-10"></a>    vxs         <span class="ot">=</span> toList (uVar  <span class="op">&lt;$&gt;</span> us)</span>
<span id="cb20-11"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-11"></a>    (fx, hgrad) <span class="ot">=</span> hessian' f xs</span>
<span id="cb20-12"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-12"></a>    dfxs        <span class="ot">=</span> <span class="fu">fst</span> <span class="op">&lt;$&gt;</span> hgrad</span>
<span id="cb20-13"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-13"></a>    hess        <span class="ot">=</span> <span class="fu">snd</span> <span class="op">&lt;$&gt;</span> hgrad</span>
<span id="cb20-14"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-14"></a>    y           <span class="ot">=</span> fx <span class="op">+</span> partials <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb20-15"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-15"></a>      <span class="kw">where</span></span>
<span id="cb20-16"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-16"></a>        partials <span class="ot">=</span> dot vxs</span>
<span id="cb20-17"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-17"></a>                 <span class="op">.</span> diag</span>
<span id="cb20-18"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-18"></a>                 <span class="op">$</span> toList (<span class="fu">fmap</span> toList hess) <span class="co">-- from f (f a) to [[a]]</span></span>
<span id="cb20-19"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-19"></a>    vy          <span class="ot">=</span> dot vxs</span>
<span id="cb20-20"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb20-20"></a>                <span class="op">$</span> toList ((<span class="op">^</span><span class="dv">2</span>) <span class="op">&lt;$&gt;</span> dfxs)</span></code></pre></div>
<p>(Again, don’t mind the scary type <code>forall s. f (AD s (Sparse a)) -&gt; AD s (Sparse a)</code>, it’s just <em>ad</em>’s type for things you can use <code>hessian'</code> on)</p>
<p>And we can write some nice helper functions so we can use them more naturally:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><div class="code-link-box hide"><a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs#L74-L87" class="code-source-link">View full source</a></div><code class="sourceCode haskell"><span id="cb21-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-3"></a><span class="ot">liftU2 ::</span> <span class="dt">Fractional</span> a</span>
<span id="cb21-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-4"></a>       <span class="ot">=&gt;</span> (<span class="kw">forall</span> s<span class="op">.</span> <span class="dt">AD</span> s (<span class="dt">Sparse</span> a) <span class="ot">-&gt;</span> <span class="dt">AD</span> s (<span class="dt">Sparse</span> a) <span class="ot">-&gt;</span> <span class="dt">AD</span> s (<span class="dt">Sparse</span> a))</span>
<span id="cb21-5"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-5"></a>       <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb21-6"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-6"></a>       <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb21-7"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-7"></a>       <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb21-8"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-8"></a>liftU2 f x y <span class="ot">=</span> liftUF (\(<span class="dt">V2</span> x' y') <span class="ot">-&gt;</span> f x' y') (<span class="dt">V2</span> x y)</span>
<span id="cb21-9"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-9"></a></span>
<span id="cb21-10"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-10"></a><span class="ot">liftU3 ::</span> <span class="dt">Fractional</span> a</span>
<span id="cb21-11"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-11"></a>       <span class="ot">=&gt;</span> (<span class="kw">forall</span> s<span class="op">.</span> <span class="dt">AD</span> s (<span class="dt">Sparse</span> a) <span class="ot">-&gt;</span> <span class="dt">AD</span> s (<span class="dt">Sparse</span> a) <span class="ot">-&gt;</span> <span class="dt">AD</span> s (<span class="dt">Sparse</span> a) <span class="ot">-&gt;</span> <span class="dt">AD</span> s (<span class="dt">Sparse</span> a))</span>
<span id="cb21-12"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-12"></a>       <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb21-13"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-13"></a>       <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb21-14"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-14"></a>       <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb21-15"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-15"></a>       <span class="ot">-&gt;</span> <span class="dt">Uncert</span> a</span>
<span id="cb21-16"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb21-16"></a>liftU3 f x y z <span class="ot">=</span> liftUF (\(<span class="dt">V3</span> x' y' z') <span class="ot">-&gt;</span> f x' y' z') (<span class="dt">V3</span> x y z)</span></code></pre></div>
<p>At this point, our code is pretty much complete. We can fill in the other two-argument functions from the numeric typeclasses:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb22-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb22-1"></a>(<span class="op">+</span>)     <span class="ot">=</span> liftU2 (<span class="op">+</span>)</span>
<span id="cb22-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb22-2"></a>(<span class="op">*</span>)     <span class="ot">=</span> liftU2 (<span class="op">*</span>)</span>
<span id="cb22-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb22-3"></a>(<span class="op">/</span>)     <span class="ot">=</span> liftU2 (<span class="op">/</span>)</span>
<span id="cb22-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb22-4"></a>(<span class="op">**</span>)    <span class="ot">=</span> liftU2 (<span class="op">**</span>)</span>
<span id="cb22-5"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb22-5"></a><span class="fu">logBase</span> <span class="ot">=</span> liftU2 <span class="fu">logBase</span></span></code></pre></div>
<p>Admittedly, there’s still some slight boilerplate (that you can get rid of with some Template Haskell, maybe), but you have a <em>lot</em> less room for error, and a lot simpler to check over and read to make sure you didn’t miss any bugs.</p>
<h2 id="wrapping-it-up">Wrapping it up<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#title" class="top-link">top</a></h2>
<p>The full code (with all of the numeric instances fully implemented) is up <a href="https://github.com/mstksg/inCode/tree/master/code-samples/uncertain/Uncertain.hs">on github</a>, which you can run and explore and test by executing it or loading it with <code>stack ghci</code>. I’ve added a special <em>Show</em> instance that “rounds” your values to as many digits that your uncertainty suggests, to give more meaningful <code>show</code>s.</p>
<p>All of what’s in this post is actually up on my <em><a href="https://hackage.haskell.org/package/uncertain">uncertain</a></em> package on hackage, if you want to use it in your own projects, or see how I take this and make it more robust for real-world applications. The project also has more features on top of the basic things shown here.</p>
<h3 id="verification-and-accuracy">Verification and Accuracy<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#title" class="top-link">top</a></h3>
<p>My <em><a href="https://hackage.haskell.org/package/uncertain">uncertain</a></em> package has a Monte Carlo module to propagate uncertainty through Monte Carlo simulations. Let’s see how the values compare!</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell code-block-prompt"><code class="sourceCode haskell"><span id="cb23-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb23-1"></a>ghci<span class="op">&gt;</span> x <span class="op">+</span> y         <span class="co">-- Monte Carlo Results:</span></span>
<span id="cb23-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb23-2"></a><span class="dv">46</span> <span class="op">+/-</span> <span class="dv">2</span>            <span class="co">-- actually 46 +/- 2</span></span>
<span id="cb23-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb23-3"></a>ghci<span class="op">&gt;</span> x <span class="op">*</span> y</span>
<span id="cb23-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb23-4"></a><span class="dv">450</span> <span class="op">+/-</span> <span class="dv">40</span>          <span class="co">-- actually 450 +/- 40</span></span>
<span id="cb23-5"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb23-5"></a>ghci<span class="op">&gt;</span> <span class="fu">sqrt</span> (x <span class="op">+</span> y)</span>
<span id="cb23-6"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb23-6"></a><span class="fl">6.8</span> <span class="op">+/-</span> <span class="fl">0.2</span>         <span class="co">-- actually 6.8 +/- 0.2</span></span>
<span id="cb23-7"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb23-7"></a>ghci<span class="op">&gt;</span> <span class="fu">logBase</span> y x</span>
<span id="cb23-8"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb23-8"></a><span class="fl">0.78</span> <span class="op">+/-</span> <span class="fl">0.02</span>       <span class="co">-- actually 0.78 +/- 0.02</span></span>
<span id="cb23-9"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb23-9"></a>ghci<span class="op">&gt;</span> <span class="fu">log</span> (x<span class="op">**</span>y)</span>
<span id="cb23-10"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb23-10"></a><span class="fl">85.9</span> <span class="op">+/-</span> <span class="fl">0.3</span>        <span class="co">-- actually 83 +/- 6</span></span></code></pre></div>
<p>So, it looks like the mathematical model of uncertainty propagation matched up well with the “actual” results we gain from Monte Carlo simulations! The only one of our examples that was significantly wrong was the <img style="vertical-align:middle" src="./Automatic Propagation of Uncertainty with AD · in Code_files/png(53).latex" alt="\operatorname{log}(x^y)" title="\operatorname{log}(x^y)"> example, which heavily underestimated the uncertainty by about a factor of 20. But, remember, the model was derived after dropping the 2nd, 3rd, 4th, etc. terms of the taylor expansion for the calculation of the new uncertainty, and the 4th, 6th, etc. terms of the taylor expansion for the calculation of the new mean. For functions that have high second, third, fourth derivatives relative to the mean and the uncertainty, it’s going to be a bit off.</p>
<h3 id="what-next">What next?<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#title" class="top-link">top</a></h3>
<p>For an extension on the mathematics behind this method, Dan Piponi has a <a href="http://blog.sigfpe.com/2011/08/computing-errors-with-square-roots-of.html">great article</a> with a lot of good references for further reading on the formal method.</p>
<p>Going off of what we’ve done here, a simple extension of this would be to implement the Monte Carlo simulator I mentioned above, which is pretty straightforward to implement with the <em><a href="https://hackage.haskell.org/package/mwc-random">mwc-random</a></em> package.</p>
<p>However, the most unsettling thing here that we never deal with is what happens correlated terms that are combined. All of our math assumed uncorrelated samples. But what happens if we have expressions that involve additions of correlated values?</p>
<p>For example:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode haskell code-block-prompt"><code class="sourceCode haskell"><span id="cb24-1"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb24-1"></a>ghci<span class="op">&gt;</span> <span class="kw">let</span> x <span class="ot">=</span> <span class="fl">14.6</span> <span class="op">+/-</span> <span class="fl">0.8</span> <span class="kw">in</span> x <span class="op">+</span> x</span>
<span id="cb24-2"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb24-2"></a><span class="dv">29</span> <span class="op">+/-</span> <span class="dv">1</span></span>
<span id="cb24-3"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb24-3"></a>ghci<span class="op">&gt;</span> <span class="kw">let</span> x <span class="ot">=</span> <span class="fl">14.6</span> <span class="op">+/-</span> <span class="fl">0.8</span> <span class="kw">in</span> <span class="dv">2</span><span class="op">*</span>x</span>
<span id="cb24-4"><a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#cb24-4"></a><span class="dv">29</span> <span class="op">+/-</span> <span class="dv">2</span></span></code></pre></div>
<p>Unfortunately, <code>x + x</code> is different than <code>2*x</code>. This is because <code>x</code> acts like an <em>independent generator</em>, so when you say <code>x + x</code>, it expands to <code>(14.6 +/- 0.8) + (14.6 +/- 0.8)</code>, which represents the addition of two independent samples.</p>
<p>When you say <code>2*x</code>, that represents sampling <code>x</code> <em>once</em> and <em>doubling</em> it. If you sample <code>x</code> and double it, any error in <code>x</code> will also be doubled. That’s why the uncertainty is greater in the <code>2*x</code> version.</p>
<p>How can we account for correlated values that are combined in complex ways? Stay tuned for the next part of the <a href="https://blog.jle.im/entries/series/+uncertain.html">series</a>!<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn1" role="doc-endnote"><p>You can simulate noisy data by using uniform noise distributions, Gaussian distributions, or however manner you like that has a given expected value (mean) and “spread”. Verify by checking the <a href="https://en.wikipedia.org/wiki/Standard_deviation">standard deviation</a> of the sums!<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>This law actually comes from the mathematical <em>definition</em> of variance, so does not assume anything about the underlying distribution of the sampling — just that they are independent, and that they have defined variances.<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Or just look at my <a href="https://hackage.haskell.org/package/uncertain">package</a> :)<a href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div><footer><hr><div class="copy-content"><p>Hi, thanks for reading! You can reach me via email at <a href="mailto:justin@jle.im" class="email">justin@jle.im</a>, or at twitter at <a href="https://twitter.com/mstk">@mstk</a>! This post and all others are published under the <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/">CC-BY-NC-ND 3.0</a> license. Corrections and edits via pull request are welcome and encouraged at <a href="https://github.com/mstksg/inCode">the source repository</a>.</p>
<p>If you feel inclined, or this post was particularly helpful for you, why not consider <a href="https://www.patreon.com/justinle/overview">supporting me on Patreon</a>, or a <a href="bitcoin:3D7rmAYgbDnp4gp4rf22THsGt74fNucPDU">BTC donation</a>? :)</p></div><div class="clear"></div><ul class="entry-series"><li><div>This entry is a part of a series called <b>"Beginner/Intermediate Haskell Projects"</b>.  Find the rest of the entries in this series at its <a href="https://blog.jle.im/entries/series/+beginner-intermediate-haskell-projects.html" class="tag-a-series" title="+Beginner/Intermediate Haskell Projects"> series history</a>.</div></li><li><div>This entry is a part of a series called <b>"Uncertain"</b>.  Find the rest of the entries in this series at its <a href="https://blog.jle.im/entries/series/+uncertain.html" class="tag-a-series" title="A little intermediate Haskell walk through representing numbers with inherent
uncertainty and the implementation of my uncertain library, going over and
applying several intermediate Haskell concepts."> series history</a>.</div></li></ul><ul class="tag-list"><li><a href="https://blog.jle.im/entries/tagged/ad.html" class="tag-a-tag">#ad</a></li><li><a href="https://blog.jle.im/entries/tagged/haskell.html" class="tag-a-tag">#haskell</a></li><li><a href="https://blog.jle.im/entries/tagged/numerical-methods.html" class="tag-a-tag">#numerical methods</a></li><li><a href="https://blog.jle.im/entries/category/@haskell.html" class="tag-a-category">@HASKELL</a></li><li><a href="https://blog.jle.im/entries/category/@tutorials.html" class="tag-a-category">@TUTORIALS</a></li><li><a href="https://blog.jle.im/entries/series/+beginner-intermediate-haskell-projects.html" class="tag-a-series">+Beginner/Intermediate Haskell Projects</a></li><li><a href="https://blog.jle.im/entries/series/+uncertain.html" class="tag-a-series">+Uncertain</a></li></ul><aside class="social-buttons"><div class="addthis_toolbox addthis_default_style addthis-buttons"><a class="addthis_button_facebook_like at300b" fb:like:layout="button_count"><div class="fb-like fb_iframe_widget" data-layout="button_count" data-show_faces="false" data-share="false" data-action="like" data-width="90" data-height="25" data-font="arial" data-href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html" data-send="false" style="height: 25px;" fb-xfbml-state="rendered" fb-iframe-plugin-query="action=like&amp;app_id=641852699171929&amp;container_width=0&amp;font=arial&amp;height=25&amp;href=https%3A%2F%2Fblog.jle.im%2Fentry%2Fautomatic-propagation-of-uncertainty-with-ad.html&amp;layout=button_count&amp;locale=en_US&amp;sdk=joey&amp;send=false&amp;share=false&amp;show_faces=false&amp;width=90"><span style="vertical-align: top; width: 0px; height: 0px; overflow: hidden;"><iframe name="f3b6dea7787a0b4" width="90px" height="25px" title="fb:like Facebook Social Plugin" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" allow="encrypted-media" src="./Automatic Propagation of Uncertainty with AD · in Code_files/like.html" style="border: none; visibility: visible; width: 0px; height: 0px;"></iframe></span></div></a><a class="addthis_button_tweet at300b"><div class="tweet_iframe_widget" style="width: 62px; height: 25px;"><span><iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" class="twitter-share-button twitter-share-button-rendered twitter-tweet-button" style="position: absolute; visibility: hidden; width: 0px; height: 0px;" title="Twitter Tweet Button" src="./Automatic Propagation of Uncertainty with AD · in Code_files/tweet_button.2d991e3dfc9abb2549972ce8b64c5d85.en.html" data-url="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#.XbhN22mJR78.twitter"></iframe></span></div></a><a class="addthis_button_google_plusone" g:plusone:size="medium"></a><a class="addthis_counter addthis_pill_style addthis_nonzero" href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#" style="display: inline-block;"><a class="atc_s addthis_button_compact">Partager<span></span></a><a class="addthis_button_expanded" target="_blank" title="Plus d&#39;options..." href="https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html#">?</a></a><div class="atclear"></div></div><div class="custom-social-buttons"><div class="custom-social-button"><a href="https://www.reddit.com/submit" onclick="window.location = &#39;https://www.reddit.com/submit?url=&#39;+ encodeURIComponent(window.location); return false"><img src="./Automatic Propagation of Uncertainty with AD · in Code_files/spreddit7.gif" alt="submit to reddit"></a></div></div></aside><nav class="next-prev-links"><ul><li class="prev-entry-link">← <a href="https://blog.jle.im/entry/blog-rewrite-with-hakyll-and-purescript.html">Blog Rewrite with Hakyll and Purescript</a> (Previous)</li><li class="next-entry-link">(Next) <a href="https://blog.jle.im/entry/practical-dependent-types-in-haskell-1.html">Practical Dependent Types in Haskell: Type-Safe Neural Networks (Part 1)</a> →</li></ul></nav></footer></article><div class="post-entry"><div class="tile"><div id="disqus_thread"><iframe id="dsq-app9585" name="dsq-app9585" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Automatic Propagation of Uncertainty with AD · in Code_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 2318px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://blog.jle.im/entry/automatic-propagation-of-uncertainty-with-ad.html';
    this.page.identifier = 'uncertainty';
};
(function() {
    var d = document, s = d.createElement('script');
    s.src = '//incode.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a><br></noscript></div></div></div></div></div><div id="footer-container"><div id="footer-content"><div class="tile"><div class="footer-copyright">© 2018 Justin Le <span class="license-link">(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" class="license">CC-BY-NC-ND 3.0</a>)</span></div><div class="footer-follow social-follows"><ul class="social-follows-list"><li><ul class="social-follows-list-social"><li><a class="social-follow-twitter" title="Follow me on Twitter!" href="https://twitter.com/intent/user?user_id=mstk" onclick="window.open(
  &#39;http://twitter.com/intent/user?user_id=907281&#39;,
  &#39;facebook-share-dialog&#39;,
  &#39;width=550,height=520&#39;);
return false;
">Twitter</a></li><li><a class="social-follow-github" title="Fork me on Github!" href="https://github.com/mstksg">Github</a></li><li><a class="social-follow-twitch" title="Watch me on Twitch!" href="https://www.twitch.tv/justin_l">Twitch</a></li><li><a class="social-follow-patreon" title="Support me on Patreon!" href="https://www.patreon.com/justinle/overview">Patreon</a></li><li><a class="social-follow-gplus" title="Add me on Google+!" href="https://plus.google.com/+JustinLe">Google+</a></li><li><a class="social-follow-keybase" title="Track me on Keybase!" href="https://keybase.io/mstksg">Keybase</a></li><li><a class="social-follow-linkedin" title="Connect with me on LinkedIn!" href="https://linkedin.com/in/lejustin">LinkedIn</a></li><li><a class="social-follow-bitcoin" title="Donate via bitcoin!" href="bitcoin:3D7rmAYgbDnp4gp4rf22THsGt74fNucPDU">Bitcoin</a></li></ul></li><li><ul class="social-follows-list-site"><li><a class="social-follow-rss" title="Subscribe to my RSS Feed!" href="http://feeds.feedburner.com/incodeblog">RSS</a></li><li><a class="social-follow-email" title="Subscribe to the mailing list!" href="https://feedburner.google.com/fb/a/mailverify?loc=en_US&amp;uri=incodeblog">Mailing list</a></li></ul></li></ul></div></div></div></div><iframe style="display: none;" src="./Automatic Propagation of Uncertainty with AD · in Code_files/saved_resource(1).html"></iframe><iframe scrolling="no" frameborder="0" allowtransparency="true" src="./Automatic Propagation of Uncertainty with AD · in Code_files/widget_iframe.2d991e3dfc9abb2549972ce8b64c5d85.html" title="Twitter settings iframe" style="display: none;"></iframe></body></html>